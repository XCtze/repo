
-- Wait for game to fully load
while not game:IsLoaded() do wait() end
while not game.Players.LocalPlayer do wait() end

local lplr = game.Players.LocalPlayer
while not lplr.Character do wait() end
local ldata = game.ReplicatedStorage:WaitForChild("Datas"):WaitForChild(lplr.UserId)

-- Function to clear everything under Lighting
local function clearLighting()
    local lighting = game:GetService("Lighting")
    for _, obj in ipairs(lighting:GetChildren()) do
        obj:Destroy()
    end
end

-- Clear Lighting immediately on game load
clearLighting()

-- Load the character in
if lplr.PlayerGui:FindFirstChild("Start") then
    game:GetService("ReplicatedStorage").Package.Events.Start:InvokeServer()
    if workspace.Others:FindFirstChild("Title") then
        workspace.Others.Title:Destroy()
    end
    local cam = game.Workspace.CurrentCamera
    cam.CameraType = Enum.CameraType.Custom
    cam.CameraSubject = lplr.Character.Humanoid
    _G.Ready = true
    game.StarterGui:SetCoreGuiEnabled(Enum.CoreGuiType.All, true)
    lplr.PlayerGui:WaitForChild("Main").Enabled = true
    if lplr.PlayerGui:FindFirstChild("Start") then
        lplr.PlayerGui.Start:Destroy()
    end
    lplr.PlayerGui.Main.bruh.Enabled = false
    lplr.PlayerGui.Main.bruh.Enabled = true
end

local function equipSkill()
    local args = { "Godly SSJ2" }
    local package = game:GetService("ReplicatedStorage"):WaitForChild("Package"):WaitForChild("Events")
    
    package:WaitForChild("equipskill"):InvokeServer(unpack(args))
    package:WaitForChild("ta"):InvokeServer()
end

-- Function to remove unwanted effects
local function removeEffects(character)
    if character then
        for _, descendant in ipairs(character:GetDescendants()) do
            if descendant:IsA("Instance") then
                local name = descendant.Name:lower()
                if name == "body" or name == "a1" or name == "idleaura" or name == "lightning" or name:find("attachment") then
                    descendant:Destroy()
                end
            end
            if descendant:IsA("ParticleEmitter") then
                descendant:Destroy()
            end
        end
    end
end

local function checkAndRemoveEffects()
    local status = lplr:FindFirstChild("Status")
    local transformation = status and status:FindFirstChild("Transformation")

    if transformation and transformation:IsA("StringValue") and transformation.Value ~= "None" then
        for _ = 1, 2 do -- Run exactly twice
            if lplr.Character then
                removeEffects(lplr.Character)
            end
            task.wait(1) -- Short delay between executions
        end
    end
end

-- Run when character spawns
lplr.CharacterAdded:Connect(function(character)
    task.wait(2) -- Wait 2 seconds for character to fully load
    checkAndRemoveEffects()
end)

-- Run when Transformation changes (only twice per change)
local status = lplr:FindFirstChild("Status")
if status then
    local transformation = status:FindFirstChild("Transformation")
    if transformation then
        transformation:GetPropertyChangedSignal("Value"):Connect(function()
            checkAndRemoveEffects()
        end)
    end
end

-- Initial check after full load
task.wait(2)
checkAndRemoveEffects()
